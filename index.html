<!doctype html>
<html lang="en">

<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<title>JQDrill</title>
</head>


<head>
  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
</head>
<body>
  <style>
  textarea {
    height: 500px;
  }
  #accordionExample{
    height: 500px;
  }

</style>
<!--######## NAV BAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-light ">
  <a class="navbar-brand mb-0 h1" href="#">JQDrill Beta</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item ">
        <a class="nav-link" href="#">JQDrill </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" target="_blank" href="http://jscut.org/">JSCut</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" target="_blank" href="https://inkscape.org/#">InkScape</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" target="_blank" href="http://flatcam.org/">Flatcam</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" target="_blank" href="https://ncviewer.com/">NCviewer</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" target="_blank" href="https://camotics.org/">CAMotics</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" target="_blank" href="https://youtube.com/">Tutorial</a>
      </li>
    </ul>
    <span class="navbar-text">
        info@necatier.com / ernecati@gmail.com
      </span>
  </div>
</nav>

<div class="container-fluid" style="height: 30px;">
<code>All applications mentioned in this site are Open-Sourced and free to use. </code>
</div>
<!--######## INPUT -->
<div class="container">
  <div class="row">
    <div class="col text-center">

      <div class="form-floating">
        <textarea class="form-control" placeholder="Paste yout GCode" id="input" style="height: 500px"></textarea>
        <label  for="input">Input GCodes</label>
      </div>
      <button type="button" class="btn btn-primary" style="margin-top: 10px;" disabled>1-Paste your GCode</button>
    </div>
    <div class="col text-center">
<!--######## ACCORDION -->
      <div class="accordion" id="accordionExample">
        <div id="ac_it" class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
              How to use?
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <strong>JQDrill is a GCode purifier for generating straight plunge GCode.</strong> Uses GCodes which generated by "JScut.org". You can convert your SVG files to GCode with jscut. But jscut generates 'path followed' codes. If you need to drill a hole jscode drills it with a spiral path.
              After you generate your 'spiral pathed' gcodes, you can convert them straight plunge gcodes. For PCB drill you have two options.You can check your GCodes with NCviewer on browser or CAMotics on you desktop.
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
              Method #1
            </button>
          </h2>
          <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <strong>With using InkScape you can determine hole coordinates.</strong> Just create a blank page with your cnc size. Put circle centers to coordinates of holes that you want to drill. Circle diameters must bigger than yor drill diameter. Color and other parameters are not important. Select all circles <kbd>Ctrl+A</kbd> on the screen and convert them to path <kbd>Ctrl+Shift+N</kbd> After saving your SVG file browse to jscut.org and generate your GCode. Open your GCode with any text editor, copy all of them and paste to input text area.
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingThree">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
              Method #2
            </button>
          </h2>
          <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <strong>If you designed your pcb as Gerber file or if you have a excellon file you can generate svg file with Flatcam. </strong> Run Flatcam software and open <kbd>Ctrl+E</kbd> your excellon file. Select your excellion file on 'Project' tab and click 'Selected' tab. Configure you settings and click 'Generate Drills GCode'. Generally generated GCode not compatible for sizing. Bu yu can export your GCode as SVG with Flatcam. When you export your SVG, turn the Method #1.
            </div>
          </div>
        </div>
      </div>
      <button id="parse" type="button" style="margin-top: 10px;" class="btn btn-primary">2-Generate Drill GCode</button>
    </div>

<!--######## OUTPUT -->
    <div class="col text-center">
      <div class="form-floating">
        <textarea class="form-control" placeholder="Paste yout GCode" id="output" style="height: 500px"></textarea>
        <label  for="output">Output GCodes</label>
      </div>
      <button id="save" type="button" style="margin-top: 10px;" class="btn btn-primary">3-Save Drill GCode</button>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>

<script>


$("#parse").click( parseCodeF());
$("#save").click( saveTextAsFile());

function parseCodeF() {
  return function() {
    var text = $('#input').val();
    var lines = text.split('\n');
    var ret_count = 0;

    for(var lineNumber = 0; lineNumber < lines.length; lineNumber ++){

      var ret_ = lines[lineNumber].indexOf("Retract");
      if (ret_ !== -1){
        ret_count ++;
        var ret_point = lineNumber;
        for (lineNumber; lineNumber>0; lineNumber --)
        {
          var plunge_ = lines[lineNumber].indexOf("plunge");
          if ( plunge_ !== -1){
            //console.log ("Delete between: " + ret_point + " - " + lineNumber);
            var plunge_point = lineNumber + 2;
            var delDif = ret_point - plunge_point
            lines.splice(plunge_point,delDif);
            lineNumber = ret_point	;
            break;
          }
        }
      }
    }
    var newtext = lines.join('\n');
    $('#output').val(newtext);
  }
}

function saveTextAsFile()
{
  return function(){
    textToWrite = $('#output').val();
    if(textToWrite !== ""){
      var d = new Date();
      var strName = d.getTime().toString()+".gcode";
      fileNameToSaveAs = strName;
      var textFileAsBlob = new Blob([textToWrite], {type:'text/plain'});
      var downloadLink = document.createElement("a");
      downloadLink.download = fileNameToSaveAs;
      downloadLink.innerHTML = "Download File";
      if (window.webkitURL != null)
      {
        downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
      }
      else
      {
        downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
        downloadLink.onclick = destroyClickedElement;
        downloadLink.style.display = "none";
        document.body.appendChild(downloadLink);
      }

      downloadLink.click();
    }
  }
}
</script>
